<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Lab/IO/file-descriptors">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">File Descriptors | Operating Systems</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://localhost//operating-systems/Lab/IO/file-descriptors"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="File Descriptors | Operating Systems"><meta data-rh="true" name="description" content="After running the code in the &quot;File Handlers&quot; section, you saw that open() returns a number."><meta data-rh="true" property="og:description" content="After running the code in the &quot;File Handlers&quot; section, you saw that open() returns a number."><link data-rh="true" rel="canonical" href="http://localhost//operating-systems/Lab/IO/file-descriptors"><link data-rh="true" rel="alternate" href="http://localhost//operating-systems/Lab/IO/file-descriptors" hreflang="en"><link data-rh="true" rel="alternate" href="http://localhost//operating-systems/Lab/IO/file-descriptors" hreflang="x-default"><link rel="stylesheet" href="/operating-systems/assets/css/styles.17f22a47.css">
<link rel="preload" href="/operating-systems/assets/js/runtime~main.03aa3b19.js" as="script">
<link rel="preload" href="/operating-systems/assets/js/main.7a3e3663.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/operating-systems/"><div class="navbar__logo"><img src="/operating-systems/img/logo.svg" alt="Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/operating-systems/img/logo.svg" alt="Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">SO</b></a><a class="navbar__item navbar__link" href="/operating-systems/Lecture">Lecture</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/operating-systems/Lab">Lab</a><a class="navbar__item navbar__link" href="/operating-systems/Assignments">Assignments</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/operating-systems/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/operating-systems/Lecture/">Lecture</a><button aria-label="Toggle the collapsible sidebar category &#x27;Lecture&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/operating-systems/Lab/">Lab</a><button aria-label="Toggle the collapsible sidebar category &#x27;Lab&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/operating-systems/Lab/lab-setup">Setting up the Lab Environment</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/operating-systems/Lab/Software Stack/">Software Stack</a><button aria-label="Toggle the collapsible sidebar category &#x27;Software Stack&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/operating-systems/Lab/Data/">Data</a><button aria-label="Toggle the collapsible sidebar category &#x27;Data&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/operating-systems/Lab/Compute/">Compute</a><button aria-label="Toggle the collapsible sidebar category &#x27;Compute&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/operating-systems/Lab/IO/">IO</a><button aria-label="Toggle the collapsible sidebar category &#x27;IO&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/operating-systems/Lab/IO/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/operating-systems/Lab/IO/file-handlers">File Handlers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/operating-systems/Lab/IO/file-descriptors">File Descriptors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/operating-systems/Lab/IO/redirections">Redirections</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/operating-systems/Lab/IO/pipes">Pipes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/operating-systems/Lab/IO/local-io-in-action">Local IO in Action</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/operating-systems/Lab/IO/remote-io">Remote IO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/operating-systems/Lab/IO/networking-101">Networking 101</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/operating-systems/Lab/IO/client-server-model">Client-Server Model</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/operating-systems/Lab/IO/beyond-network-sockets">Beyond Network Sockets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/operating-systems/Lab/IO/file-mappings">File Mappings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/operating-systems/Lab/IO/io-internals">IO Internals</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/operating-systems/Lab/IO/zero-copy">Zero-Copy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/operating-systems/Lab/IO/async-io">Asynchronous IO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/operating-systems/Lab/IO/io-multiplexing">IO Multiplexing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/operating-systems/Lab/IO/arena">Arena</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/operating-systems/Lab/Application Interaction/">Application Interaction</a><button aria-label="Toggle the collapsible sidebar category &#x27;Application Interaction&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/operating-systems/Assignments/">Assignments</a><button aria-label="Toggle the collapsible sidebar category &#x27;Assignments&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/operating-systems/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/operating-systems/Lab/"><span itemprop="name">Lab</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/operating-systems/Lab/IO/"><span itemprop="name">IO</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">File Descriptors</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>File Descriptors</h1><p>After running the code in the <a href="/operating-systems/Lab/IO/file-handlers">&quot;File Handlers&quot; section</a>, you saw that <code>open()</code> returns a <strong>number</strong>.
This number is a <strong>file descriptor</strong>.
Run the code above multiple times.
You&#x27;ll always get file descriptor 3.
We can already tell these numbers have some meaning and aren&#x27;t just some seemingly random numbers, like PIDs were.</p><p>You&#x27;ve most likely used file descriptors before without knowing.
Remember the following concepts:</p><ul><li><code>stdin</code> (standard input)</li><li><code>stdout</code> (standard output)</li><li><code>stderr</code> (standard error)</li></ul><p>When you wanted to run a shell command and ignore its errors, you wrote something like:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~$ ls 2&gt; /dev/null</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The command above uses <code>2&gt; /dev/null</code> to <strong>redirect</strong> <code>stderr</code> to /dev/null.</p><p><a href="/operating-systems/Lab/IO/quiz/stderr-fd">Quiz</a></p><p>Good, so we know that <code>stderr</code> is file descriptor 2.
The code in <code>support/file-descriptors/open_directory.c</code> opened the directory as file descriptor 3.
So what are file descriptors 0 and 1?
They are <code>stdin</code> and <code>stdout</code>, respectively.</p><p>Now we know that the basic I/O streams of a process correspond to specific file descriptors.
But what is a file descriptor exactly?
From the application&#x27;s point of view, it is a positive integer acting as a unique identifier for an I/O channel, such as a file.
To the operating system, a file descriptor is an index.
Each process has what&#x27;s called a <strong>file descriptor table</strong>, which is just a fancy name for an array of pointers.
A file descriptor is an index in this array.
Each element in this array points towards a structure in the kernel&#x27;s memory that represents an I/O resource.
This structure is called the <strong>open file structure</strong>.</p><p>To illustrate all this information, look at the image below.
All data structures shown below are stored in the Kernel&#x27;s memory area and are transparent to the user space.
And remember that the file descriptor table is bound to the process, so all its threads share the same file descriptors.</p><p><img loading="lazy" alt="File Descriptors" src="/operating-systems/assets/images/file-descriptors-d19424f0a417ecd1c032f98a1969ad75.svg" width="462" height="242" class="img_ev3q"></p><p>To find out more about the contents of these structures, check out <a href="/operating-systems/Lab/IO/arena#open-file-structure-in-the-kernel">this section in the Arena</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-new-file-descriptors">Creating New File Descriptors<a class="hash-link" href="#creating-new-file-descriptors" title="Direct link to heading">​</a></h2><p>We already know that each process gets 3 file descriptors &quot;by default&quot;:</p><ul><li><code>stdin</code> (standard input): 0</li><li><code>stdout</code> (standard output): 1</li><li><code>stderr</code> (standard error): 2</li></ul><p>To create new file descriptors (i.e. open new files), a process can use the <a href="https://man7.org/linux/man-pages/man2/open.2.html" target="_blank" rel="noopener noreferrer"><code>open()</code></a> system call.
It receives the path to the file, some flags which are akin to the <code>mode</code> string passed to <code>fopen()</code>.
An optional <code>mode</code> parameter that denotes the file&#x27;s permissions if the <code>open</code> must create it can also be provided.
We&#x27;ll revisit <code>open()</code>&#x27;s <code>mode</code> parameter in the future.</p><p>From now, you should consult <a href="https://man7.org/linux/man-pages/man2/open.2.html" target="_blank" rel="noopener noreferrer"><code>open()</code>&#x27;s man page</a> whenever you encounter a new argument to this syscall.
Navigate to <code>support/file-descriptors/open_read_write.c</code>.
The function <code>open_file_for_reading()</code> calls <code>open()</code> with the <code>O_RDONLY</code> flag, which is equivalent to opening the file with <code>fopen()</code> and setting <code>&quot;r&quot;</code> as the <code>mode</code>.
This means read-only.
Note that the file descriptor we get is 3, just like before.</p><p>Then <code>read_from_file()</code> reads <code>bytes_to_read</code> bytes from this file.
For this, it uses the <code>read()</code> syscall.
It returns the number of bytes that were read from the file.</p><p>Notice that the code doesn&#x27;t simply call <code>read(fd, buff, bytes_to_read)</code>.
Instead, it uses a <code>while</code> loop to read data from the file.</p><p>The <a href="https://man7.org/linux/man-pages/man2/read.2.html#RETURN_VALUE" target="_blank" rel="noopener noreferrer">return value of <code>read()</code></a> may be less than <code>bytes_to_read</code> if there are not enough bytes available or if the operation is interrupted by a signal.
A return value between <strong>0</strong> and <code>bytes_to_read</code> is not enough to decide whether we should stop reading.
To determine this, we make another <code>read()</code> call, which will return <strong>0</strong> if the cursor is already at <strong>EOF</strong> (end of file).</p><p>The same goes for <code>write()</code>: its return value may differ from the intended number of bytes to write.
Partial writes should also be handled at the application level, and the way to do this is by using loops.</p><p><strong>Remember:</strong>
<strong>It is mandatory that we always use <code>read()</code> and <code>write()</code> inside <code>while</code> loops.</strong>
Higher-level functions like <code>fread()</code> and <code>fwrite()</code> also use <code>while</code> loops when calling <code>read()</code> and <code>write()</code> respectively.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="practice-open-a-file-for-writing">Practice: Open a File for Writing<a class="hash-link" href="#practice-open-a-file-for-writing" title="Direct link to heading">​</a></h3><p>Follow the code in <code>open_file_for_reading()</code> and fill in the function <code>open_file_for_writing()</code>.
The file <code>write_file.txt</code> doesn&#x27;t exist.
<code>open()</code> should create it.
Use the <code>open()</code>&#x27;s man page to find the flags you require.
Do you require anything <em>else</em>?</p><p>At this point, depending on what flags you passed to <code>open()</code>, a few things might happen.
Work your way through the errors until successfully create and open the file.
The <code>open()</code> syscall should return file descriptor 4.</p><p>Now verify the file.
This part may be different on your system.
Delete <code>write_file.txt</code> and rerun <code>open_read_write</code> a few times.
Each time, check the permissions of <code>write_file.txt</code>.
They may be different between runs, or they may always be the same.
Anyway, they are likely not the default permissions for a regular file (<code>rw-r--r--</code>).
It is not mandatory that you get the same output as below.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../lab/support/file-descriptors$ ls -l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">total 11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxrwxr-x 1 student student 4096 Nov 20 18:26 ./</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxrwxr-x 1 student student    0 Nov 20 14:11 ../</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-rw-r-- 1 student student   46 Nov 20 17:27 .gitignore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-rw-r-- 1 student student  125 Nov 20 18:26 Makefile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-rw-r-- 1 student student  396 Nov 20 11:27 open_directory.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-rw-r-- 1 student student 2210 Nov 20 17:24 open_read_write.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-rw-r-- 1 student student  34 Nov 20 18:26 read_file.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------- 1 student student  45 Nov 20 18:26 write_file.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><a href="/operating-systems/Lab/IO/quiz/write-file-permissions">Quiz</a></p><p><strong>Remember:</strong>
<strong>It is mandatory that we pass a <code>mode</code> argument to <code>open()</code> when using the <code>O_CREAT</code> flag.</strong></p><p>Now pass some sensible <code>mode</code> argument to <code>open()</code>, such as <code>0644</code> (for <code>rw-r--r--</code> permissions).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="practice-write-to-the-file">Practice: Write to the File<a class="hash-link" href="#practice-write-to-the-file" title="Direct link to heading">​</a></h3><p>Follow the example in <code>read_from_file()</code> to fill in <code>write_to_file()</code>.
Remember to use a loop to make sure your data is fully written to the file.</p><ol><li><p>Use <code>cat write_file.txt</code> to check if the file contains the right data.</p></li><li><p>Use <code>open_file_for_reading()</code> and <code>read_from_file()</code> to reopen <code>write_file.txt</code> for reading and read the bytes you&#x27;ve just written to it.</p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="replace-or-truncate">Replace or Truncate?<a class="hash-link" href="#replace-or-truncate" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="practice-write-once-more">Practice: Write Once More<a class="hash-link" href="#practice-write-once-more" title="Direct link to heading">​</a></h3><p>Change the message written to <code>write_file.txt</code> by <code>support/file-descriptors/open_read_write.c</code> <strong>to a shorter one</strong>.
It is important that the new message be shorter than the first one.
Now recompile the code, then run it, and then inspect the contents of the <code>write_file.txt</code> file.</p><p>If the new message were <code>&quot;Something short&quot;</code>, the contents of <code>write_file.txt</code> should be:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../lab/support/file-descriptors$ cat ../../support/file-descriptors/write_file.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Something shorte_file.txt: What&#x27;s up, Doc?</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that the final bytes of the previous text remain unchanged.
The new message was simply written <strong>on top</strong> of the old one.</p><p>Now let&#x27;s do a quick test.
We haven&#x27;t talked about how redirections work in the terminal (we&#x27;ll get there, step by step), but you can imagine that if you type <code>ls &gt; file.txt</code>, <code>file.txt</code> has to be opened at some point.
Let&#x27;s write data to a file twice and observe the behaviour:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../lab/support/file-descriptors$ ls -l &gt; file.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../lab/support/file-descriptors$ cat file.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">total 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-rw-r-- 1 student student    0 Nov 20 21:11 file.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-rw-r-- 1 student student  125 Nov 20 18:26 Makefile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-rw-r-- 1 student student  396 Nov 20 21:10 open_directory.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-rw-r-- 1 student student 2300 Nov 20 20:51 open_read_write.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-rw-r-- 1 student student   34 Nov 20 18:26 read_file.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r-- 1 student student   45 Nov 20 20:56 write_file.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../lab/support/file-descriptors$ ls &gt; file.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../lab/support/file-descriptors$ cat file.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Makefile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">open_directory.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">open_read_write.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">read_file.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">write_file.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The second output is shorter than the first, yet the first output is no longer present in the file after the second <code>ls</code>.
How come?
Well, the reason is another flag being passed to <code>open()</code>: <code>O_TRUNC</code>.
At this point, you should be accustomed to looking for this flag in <code>open()</code>&#x27;s man page.
Go ahead and do it.</p><p><a href="/operating-systems/Lab/IO/quiz/o-trunc">Quiz 1</a></p><p><a href="/operating-systems/Lab/IO/quiz/fopen-w">Quiz 2</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="practice-closeem-all">Practice: Close&#x27;em All<a class="hash-link" href="#practice-closeem-all" title="Direct link to heading">​</a></h3><p>Just like you use <code>open()</code> to create new file descriptors, you can use <a href="https://man7.org/linux/man-pages/man2/close.2.html" target="_blank" rel="noopener noreferrer"><code>close()</code></a> to destroy them.
This clears and frees the open file structure to which that entry in the file descriptor table is pointing.
Use <code>close()</code> on the file descriptors you&#x27;ve opened so far in <code>support/file-descriptors/open_read_write.c</code>.</p><p>Note that you don&#x27;t have to close file descriptors 0, 1 and 2 manually.
The standard streams are meant to stay alive throughout the lifetime of the process.
Just like calling <code>free()</code> on a <code>malloc()</code>-ed pointer, calling <code>close()</code> is not really necessary.
When a process terminates, the OS closes all its file descriptors the same way it frees all its memory.</p><p>And keeping this comparison with <code>malloc()</code> and <code>free()</code>, closing file descriptors is important when they are created inside a loop, as the file descriptor table&#x27;s size is limited.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="file-handling-conclusion-libc-vs-syscalls">File Handling Conclusion: libc vs syscalls<a class="hash-link" href="#file-handling-conclusion-libc-vs-syscalls" title="Direct link to heading">​</a></h2><p>Up to now, we can draw some parallels between <code>fopen()</code> and <code>open()</code>.
While <code>fopen()</code> allows the usage of high-level functions such as <code>fread()</code> and <code>fwrite()</code>, which, among other things, use <code>while</code> loops to ensure they always read the required number of bytes, the libc-specific API is not generic enough.</p><p>In the following sections, we&#x27;ll use file descriptors and <code>read()</code> and <code>write()</code> to interact with some inter-process-communication mechanisms, such as pipes.</p><p>The table below shows the higher level API provided by libc and the syscalls it relies on.
As usual, use the <code>man</code> pages when in doubt about either of them.</p><table><thead><tr><th align="center">libc</th><th align="center">syscall</th></tr></thead><tbody><tr><td align="center"><code>fopen()</code></td><td align="center"><code>open()</code></td></tr><tr><td align="center"><code>fread()</code></td><td align="center"><code>read()</code></td></tr><tr><td align="center"><code>fwrite()</code></td><td align="center"><code>write()</code></td></tr><tr><td align="center"><code>fseek()</code></td><td align="center"><code>lseek()</code></td></tr><tr><td align="center"><code>fclose()</code></td><td align="center"><code>close()</code></td></tr></tbody></table><p>So for most equivalents, just remove the leading <code>f</code> when moving from the libc function to the underlying syscall.</p><p>For a quick recap of the flags we&#x27;ve discussed so far, take a look at the following table.
But don&#x27;t bother memorising it.
You can find it any time in by typing <a href="https://man7.org/linux/man-pages/man3/fopen.3.html" target="_blank" rel="noopener noreferrer"><code>man fopen</code></a> in your terminal.</p><table><thead><tr><th align="center"><code>fopen()</code> mode</th><th align="center"><code>open()</code> flag</th></tr></thead><tbody><tr><td align="center"><code>&quot;r&quot;</code></td><td align="center"><code>O_RDONLY</code></td></tr><tr><td align="center"><code>&quot;w&quot;</code></td><td align="center"><code>O_WRONLY │ O_CREAT │ O_TRUNC</code></td></tr><tr><td align="center"><code>&quot;a&quot;</code></td><td align="center"><code>O_WRONLY │ O_CREAT │ O_APPEND</code></td></tr><tr><td align="center"><code>&quot;r+&quot;</code></td><td align="center"><code>O_RDWR</code></td></tr><tr><td align="center"><code>&quot;w+&quot;</code></td><td align="center"><code>O_RDWR │ O_CREAT │ O_TRUNC</code></td></tr><tr><td align="center"><code>&quot;a+&quot;</code></td><td align="center"><code>O_RDWR │ O_CREAT │ O_APPEND</code></td></tr></tbody></table></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/operating-systems/Lab/IO/file-handlers"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">File Handling</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/operating-systems/Lab/IO/redirections"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Redirections</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#creating-new-file-descriptors" class="table-of-contents__link toc-highlight">Creating New File Descriptors</a><ul><li><a href="#practice-open-a-file-for-writing" class="table-of-contents__link toc-highlight">Practice: Open a File for Writing</a></li><li><a href="#practice-write-to-the-file" class="table-of-contents__link toc-highlight">Practice: Write to the File</a></li></ul></li><li><a href="#replace-or-truncate" class="table-of-contents__link toc-highlight">Replace or Truncate?</a><ul><li><a href="#practice-write-once-more" class="table-of-contents__link toc-highlight">Practice: Write Once More</a></li><li><a href="#practice-closeem-all" class="table-of-contents__link toc-highlight">Practice: Close&#39;em All</a></li></ul></li><li><a href="#file-handling-conclusion-libc-vs-syscalls" class="table-of-contents__link toc-highlight">File Handling Conclusion: libc vs syscalls</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://curs.upb.ro" target="_blank" rel="noopener noreferrer" class="footer__link-item">Main site<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ocw.cs.pub.ro/courses/so" target="_blank" rel="noopener noreferrer" class="footer__link-item">OCW<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/sisteme.de.operare/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 SO Team</div></div></div></footer></div>
<script src="/operating-systems/assets/js/runtime~main.03aa3b19.js"></script>
<script src="/operating-systems/assets/js/main.7a3e3663.js"></script>
</body>
</html>