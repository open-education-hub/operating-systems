<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Lab/Data/memory-security">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Memory Security | Operating Systems</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://localhost//operating-systems/Lab/Data/memory-security"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Memory Security | Operating Systems"><meta data-rh="true" name="description" content="Memory security is one of the most important aspects in today&#x27;s computer systems."><meta data-rh="true" property="og:description" content="Memory security is one of the most important aspects in today&#x27;s computer systems."><link data-rh="true" rel="canonical" href="http://localhost//operating-systems/Lab/Data/memory-security"><link data-rh="true" rel="alternate" href="http://localhost//operating-systems/Lab/Data/memory-security" hreflang="en"><link data-rh="true" rel="alternate" href="http://localhost//operating-systems/Lab/Data/memory-security" hreflang="x-default"><link rel="stylesheet" href="/operating-systems/assets/css/styles.17f22a47.css">
<link rel="preload" href="/operating-systems/assets/js/runtime~main.03aa3b19.js" as="script">
<link rel="preload" href="/operating-systems/assets/js/main.7a3e3663.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/operating-systems/"><div class="navbar__logo"><img src="/operating-systems/img/logo.svg" alt="Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/operating-systems/img/logo.svg" alt="Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">SO</b></a><a class="navbar__item navbar__link" href="/operating-systems/Lecture">Lecture</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/operating-systems/Lab">Lab</a><a class="navbar__item navbar__link" href="/operating-systems/Assignments">Assignments</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/operating-systems/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/operating-systems/Lecture/">Lecture</a><button aria-label="Toggle the collapsible sidebar category &#x27;Lecture&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/operating-systems/Lab/">Lab</a><button aria-label="Toggle the collapsible sidebar category &#x27;Lab&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/operating-systems/Lab/lab-setup">Setting up the Lab Environment</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/operating-systems/Lab/Software Stack/">Software Stack</a><button aria-label="Toggle the collapsible sidebar category &#x27;Software Stack&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/operating-systems/Lab/Data/">Data</a><button aria-label="Toggle the collapsible sidebar category &#x27;Data&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/operating-systems/Lab/Data/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/operating-systems/Lab/Data/working-memory">Working with Memory</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/operating-systems/Lab/Data/process-memory">Process Memory</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/operating-systems/Lab/Data/investigate-memory">Investigate Memory</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/operating-systems/Lab/Data/memory-security">Memory Security</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/operating-systems/Lab/Data/arena">Arena</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/operating-systems/Lab/Compute/">Compute</a><button aria-label="Toggle the collapsible sidebar category &#x27;Compute&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/operating-systems/Lab/IO/">IO</a><button aria-label="Toggle the collapsible sidebar category &#x27;IO&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/operating-systems/Lab/Application Interaction/">Application Interaction</a><button aria-label="Toggle the collapsible sidebar category &#x27;Application Interaction&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/operating-systems/Assignments/">Assignments</a><button aria-label="Toggle the collapsible sidebar category &#x27;Assignments&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/operating-systems/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/operating-systems/Lab/"><span itemprop="name">Lab</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/operating-systems/Lab/Data/"><span itemprop="name">Data</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Memory Security</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Memory Security</h1><p>Memory security is one of the most important aspects in today&#x27;s computer systems.
Its main objectives are to avoid the development of vulnerable code and prevent attackers from exploiting existing memory vulnerabilities.
Memory protection techniques are implemented at all levels of memory abstraction: hardware, operating system and programming language.
In addition, third-party software tools may be used to statically and dynamically examine a program to identify vulnerabilities when working with memory.</p><p>In this section, we will focus on the main memory vulnerabilities and how to exploit them.
We will use the C programming language for presentation purposes, however, these examples may be reproduced in any language that implements arrays as pointers without bounds and allows the liberal use of pointers.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="wild-pointer-arithmetic-info-leak">Wild Pointer Arithmetic Info Leak<a class="hash-link" href="#wild-pointer-arithmetic-info-leak" title="Direct link to heading">​</a></h2><p>In C, once a pointer has been initialized with a valid address it can potentially access any location of the process address space.
This is problematic for situations where the binary contains sensitive information.
Take for example a server that authenticates users: if the password is stored in some buffer, then if a pointer is wrongfully used, it can end up leaking the password.</p><p>Navigate to the <code>support/memory-security/</code> directory.
Open and analyze the <code>buff_leak.c</code> file.</p><p><a href="/operating-systems/Lab/Data/quiz/memory-regions-vars">Answer this quiz</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="practice">Practice<a class="hash-link" href="#practice" title="Direct link to heading">​</a></h3><p>The pointer <code>p</code> points to the stack, however, we can modify any variable that is declared in the program through <code>p</code>.
All we need to know is the offset of the other memory locations that we wish to access.
Run the program and try to input the correct offsets to modify variables from different regions of our program.
Once a correct offset is given as input, the program will output a validation message.</p><p>Note that adding or subtracting user provided values to pointers enables an attacker to observe a program&#x27;s entire memory!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="buffer-overflow-info-leak">Buffer Overflow Info Leak<a class="hash-link" href="#buffer-overflow-info-leak" title="Direct link to heading">​</a></h2><p>Since arrays decay to pointers in C, the same effect may be obtained by using them.</p><p>Navigate to the <code>support/memory-security/</code> directory.
Open and analyze the <code>array_leak.c</code> file.</p><p>Compile and run the program.
Can you extract any information from the output?
Can you identify the return address of the main function?</p><p><strong>Note:</strong> You can use <code>objdump -d -M intel array_leak</code> to check the stack layout.
<strong>Note:</strong> Depending on the environment the layout may differ.</p><p>Next, open and analyze the <code>string_leak.c</code> file.
Compile and run the program.
To better understand the output, use <code>xxd</code> to interpret the output as hexadecimal bytes:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../lab/support/memory-security$ ./string_leak | xxd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Note:</strong> <code>73</code> and <code>6f</code> are the ascii values of <code>s</code> and <code>o</code></p><p><a href="/operating-systems/Lab/Data/quiz/string-buff-over">Answer this quiz</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="practice-1">Practice<a class="hash-link" href="#practice-1" title="Direct link to heading">​</a></h3><p>In file <code>string_leak.c</code> replace the usage of <code>memcpy</code> with <code>strcpy</code>.
Do not modify anything else (including the size of the buffer).
As the name suggests, <code>strcpy()</code> is specialized for string copies, therefore we don need to specify how much we want to copy.
What is the result?
Is the result correct?
Explain the result.</p><p><a href="/operating-systems/Lab/Data/quiz/string-strcpy">Answer this quiz</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="buffer-overflow-overwrite">Buffer Overflow Overwrite<a class="hash-link" href="#buffer-overflow-overwrite" title="Direct link to heading">​</a></h2><p>Up until this point we have seen how we can exploit a buffer to leak information.
However, this vulnerability may be used most of the time to overwrite data.</p><p>Take for example the code in <code>support/memory-security/bo_write.c</code>.
Compile and run the code.
What happens?
Why?</p><p><a href="/operating-systems/Lab/Data/quiz/stack-layout">Answer this quiz</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="practice-2">Practice<a class="hash-link" href="#practice-2" title="Direct link to heading">​</a></h3><p>Open the <code>support/memory-security/bo_write_practice.c</code> file.
Analyze the code, then compile it and run it.</p><ol><li><p>Try to find an input that alters the control flow of the program so that &quot;Comm-link online&quot; is printed.
You are not allowed to modify the source file.</p></li><li><p>Try to find an input that alters the control flow of the program so that &quot;Channel open.&quot; is printed.
You are not allowed to modify the source file.</p></li></ol><p><strong>Note:</strong> Addresses are 8 bytes long on 64 bit machines.</p><ol><li>Can you think of a different input that results in printing &quot;Comm-link online&quot;?</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="aslr">ASLR<a class="hash-link" href="#aslr" title="Direct link to heading">​</a></h2><p>Address Space Layout Randomization (ASLR) is a protection technique employed by operating systems to make it harder for attackers to identify code locations to jump to.
Essentially, every program section (including shared library code) is mapped at a random virtual address every time the program is run.
That way, it is harder for the attacker to exploit a buffer overflow: the address of a potential code target is different with each run.</p><p>To enable randomization, there are 2 steps that need to be taken:</p><ol><li><p>Enable ASLR on the operating system.
This enables the operating system to map library code at different virtual addresses in a program.</p></li><li><p>Compile our code as Position Independent Code (PIC).
This instructs the compiler to generate code such that it does not use absolute addresses when calling functions or accessing variables.
As a consequence, the code may be loaded at any given address in memory.</p></li></ol><p>On most Linux systems, ASLR is enabled by default.
Modern compilers generate position independent code by default.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="practice-3">Practice<a class="hash-link" href="#practice-3" title="Direct link to heading">​</a></h3><p>Use the <code>Makefile.aslr</code> file to compile the <code>support/memory-security/aslr.c</code> file:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../lab/support/memory-security$ make -f Makefile.aslr</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>By default, ASLR and PIC are enabled.
Observe the results.
Next, we disable ASLR:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../lab/support/memory-security$ echo 0 | sudo tee /proc/sys/kernel/randomize_va_space</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Even though the code is compiled with PIC, both library and user functions have the same address between runs.
Re-enable ASLR:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../lab/support/memory-security$ echo 2 | sudo tee /proc/sys/kernel/randomize_va_space</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Disable PIC by uncommenting the <code>-fno-PIC</code> and <code>LDFLAGS</code> lines.</p><p>We observe that for randomization to work, we need to instruct the OS to randomize the program sections and the compiler to generate code that is position independent.</p><p><a href="/operating-systems/Lab/Data/quiz/memory-aslr">Answer this quiz</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="stack-protector">Stack Protector<a class="hash-link" href="#stack-protector" title="Direct link to heading">​</a></h2><p>As observed in the previous quiz, ASLR prevents an attacker (most of the times) from discovering a reliable address where to jump to, however, it does not prevent the occurrence of a buffer overflow.
An effective strategy to protect against buffer overflow is represented by the stack protector (or stack canary).
Between the end of the buffer and the return address (below the saved base pointer <code>rbp</code>), a random value is placed on the stack.
Before the function returns, the value is checked: if the initial value was modified, then an exception is issued and the program is aborted.</p><p>Stack canaries are enabled by default, however, for learning purposes we have disabled it by passing <code>-fno-stack-protector</code> to the compiler.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="practice-4">Practice<a class="hash-link" href="#practice-4" title="Direct link to heading">​</a></h3><p>Comment the <code>-fno-stack-protector</code> switch from the <code>support/memory-security/Makefile</code>, recompile and run the <code>bo_practice_write</code> executable.
Examine the binary with <code>objdump</code> and identify the instructions that set and test the canary.
Observe what happens when a buffer overflow occurs.</p><p><a href="/operating-systems/Lab/Data/quiz/memory-stack-protector">Answer this quiz</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="bypassing-the-stack-protector">Bypassing the Stack Protector<a class="hash-link" href="#bypassing-the-stack-protector" title="Direct link to heading">​</a></h2><p>The stack protector is generally placed immediately after the old <code>rbp</code>.
With this information we can craft various exploits to bypass it:</p><ul><li><p>Leak the canary and do not modify it.
Reading the canary, as long as we do not modify it is not going to cause any disturbances.
If we have the canary, we can just include it in our payload and hapily overwrite the return address.</p></li><li><p>If we have access to a pointer that we can modify appropriately, we can just jump over the canary and directly modify the return address.</p></li><li><p>In case we have multiple buffers defined in the same stack frame, we can simply overwrite data in a buffer that is placed above the buffer we are exploiting without the stack protector intervention.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="practice-5">Practice<a class="hash-link" href="#practice-5" title="Direct link to heading">​</a></h3><p>Inspect the <code>support/memory-security/stack_protector.c</code> source file.
Compile the program and examine the object code.
Try to identify the canary value.
Using the <code>addr</code> variable, write 2 <code>scanf</code> instructions: one that overwrites the canary with the corect value and one that overwrites the return address with the address of function <code>pawned</code>.
In case of a successful exploit a video will be offered as reward.</p><p><a href="/operating-systems/Lab/Data/quiz/bypass-canary">Answer this quiz</a></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/operating-systems/Lab/Data/investigate-memory"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Investigate Memory Actions</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/operating-systems/Lab/Data/arena"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Arena</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#wild-pointer-arithmetic-info-leak" class="table-of-contents__link toc-highlight">Wild Pointer Arithmetic Info Leak</a><ul><li><a href="#practice" class="table-of-contents__link toc-highlight">Practice</a></li></ul></li><li><a href="#buffer-overflow-info-leak" class="table-of-contents__link toc-highlight">Buffer Overflow Info Leak</a><ul><li><a href="#practice-1" class="table-of-contents__link toc-highlight">Practice</a></li></ul></li><li><a href="#buffer-overflow-overwrite" class="table-of-contents__link toc-highlight">Buffer Overflow Overwrite</a><ul><li><a href="#practice-2" class="table-of-contents__link toc-highlight">Practice</a></li></ul></li><li><a href="#aslr" class="table-of-contents__link toc-highlight">ASLR</a><ul><li><a href="#practice-3" class="table-of-contents__link toc-highlight">Practice</a></li></ul></li><li><a href="#stack-protector" class="table-of-contents__link toc-highlight">Stack Protector</a><ul><li><a href="#practice-4" class="table-of-contents__link toc-highlight">Practice</a></li></ul></li><li><a href="#bypassing-the-stack-protector" class="table-of-contents__link toc-highlight">Bypassing the Stack Protector</a><ul><li><a href="#practice-5" class="table-of-contents__link toc-highlight">Practice</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://curs.upb.ro" target="_blank" rel="noopener noreferrer" class="footer__link-item">Main site<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ocw.cs.pub.ro/courses/so" target="_blank" rel="noopener noreferrer" class="footer__link-item">OCW<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/sisteme.de.operare/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 SO Team</div></div></div></footer></div>
<script src="/operating-systems/assets/js/runtime~main.03aa3b19.js"></script>
<script src="/operating-systems/assets/js/main.7a3e3663.js"></script>
</body>
</html>